<ng-container *ngIf="rows && formGroup">
  <form [formGroup]="formGroup">
    <div class="column-row" *ngFor="let row of rows">
      <div class="column-col" *ngFor="let col of row" [style.width]="100/farmFormInfo.split_size + '%'">
        <div class="column-container">
          <div class="column-label">{{col.display_text}}</div>
          <div class="column-content">
            <ng-container [ngSwitch]="col.display_type">
              <!-- TEXT -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.TEXT">
                <mat-form-field appearance="legacy" [ngSwitch]="col.display_type">
                  <input matInput [formControlName]="col.column_id" [maxLength]="col.max_length"
                    [placeholder]="col.placeholder" (keydown)="columnTrigger.next(col)">
                  <mat-error *ngIf="useValidation && formGroup.controls[col.column_id]?.errors">
                    <div *ngFor="let err of (formGroup.controls[col.column_id]?.errors | farmFormValidationErrors)">
                      {{err}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </ng-container>
              <!-- TEXTAREA -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.TEXTAREA">
                <mat-form-field appearance="legacy" [ngSwitch]="col.display_type">
                  <textarea matInput [formControlName]="col.column_id" [maxLength]="col.max_length"
                    [placeholder]="col.placeholder" rows="1" (keydown)="columnTrigger.next(col)"></textarea>
                  <mat-error *ngIf="useValidation && formGroup.controls[col.column_id]?.errors">
                    <div *ngFor="let err of (formGroup.controls[col.column_id]?.errors | farmFormValidationErrors)">
                      {{err}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </ng-container>
              <!-- SELECT -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.SELECT">
                <mat-form-field appearance="legacy" [ngSwitch]="col.display_type">
                  <mat-select [formControlName]="col.column_id" (selectionChange)="columnTrigger.next(col)">
                    <mat-option *ngFor="let option of col.options" [value]="option.value">
                      {{option.text}}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="useValidation && formGroup.controls[col.column_id]?.errors">
                    <div *ngFor="let err of (formGroup.controls[col.column_id]?.errors | farmFormValidationErrors)">
                      {{err}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </ng-container>
              <!-- RADIO -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.RADIO">
                <mat-radio-group [formControlName]="col.column_id" style="width: 100%; display: block;"
                  (change)="columnTrigger.next(col)">
                  <ng-container *ngFor="let option of col.options; let i=index;">
                    <mat-radio-button [value]="option.value" style="display: inline-block;"
                      [style.marginLeft]="i===0?'0':'15px'">
                      {{option.text}}
                    </mat-radio-button>
                  </ng-container>
                </mat-radio-group>
              </ng-container>
              <!-- CHECKBOX -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.CHECKBOX">
                <mat-checkbox [formControlName]="col.column_id" (change)="columnTrigger.next(col)">
                </mat-checkbox>
              </ng-container>
              <!-- DATE -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.DATE">
                <mat-form-field appearance="legacy" [ngSwitch]="col.display_type">
                  <input matInput [matDatepicker]="picker" [formControlName]="col.column_id"
                    (dateChange)="columnTrigger.next(col)">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  <mat-error *ngIf="!useValidation && formGroup.controls[col.column_id]?.errors?.matDatepickerParse">
                    <div>日期格式不符</div>
                  </mat-error>
                  <mat-error *ngIf="useValidation && formGroup.controls[col.column_id]?.errors">
                    <div *ngFor="let err of (formGroup.controls[col.column_id]?.errors | farmFormValidationErrors)">
                      {{err}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </ng-container>
              <!-- GALLERY -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.GALLERY">
                <button type="button" mat-button (click)="changeGallery(col)">媒體庫</button>
              </ng-container>
              <!-- EDITOR -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.EDITOR">
                <button type="button" mat-button (click)="openContentEditor(col)">編輯 Content</button>
              </ng-container>
              <!-- HTMLEDITOR -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.HTMLEDITOR">
                <button type="button" mat-button (click)="openHtmlEditor(col)">編輯 Html</button>
              </ng-container>
              <!-- DATETIME -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.DATETIME">
                <mat-form-field appearance="legacy" [ngSwitch]="col.display_type">
                  <input matInput [matDatepicker]="picker" [formControlName]="col.column_id"
                    (dateChange)="columnTrigger.next(col)">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  <mat-error *ngIf="!useValidation && formGroup.controls[col.column_id]?.errors?.matDatepickerParse">
                    <div>日期格式不符</div>
                  </mat-error>
                  <mat-error *ngIf="useValidation && formGroup.controls[col.column_id]?.errors">
                    <div *ngFor="let err of (formGroup.controls[col.column_id]?.errors | farmFormValidationErrors)">
                      {{err}}
                    </div>
                  </mat-error>
                </mat-form-field>
              </ng-container>
              <!-- TREE -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.TREE">
                <cms-tree #sitemapTree class="cms-tree" [context]="this" [nodeDatas]="sitemaps" [checkbox]="true"
                  [nodeDisplayField]="'node_name'" [defaultExpandLevel]="-1"
                  (nodeCheckedChange)="onNodeCheckedChange($event)"></cms-tree>
              </ng-container>
              <!-- LABEL -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.LABEL">
                <div [innerHTML]="col.value | safeHtml"></div>
              </ng-container>
              <!-- LINK -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.LINK">
                <a [href]="col.value" target="_blank" rel="noreferrer noopener">內容預覽</a>
              </ng-container>
              <!-- CUSTOM -->
              <ng-container *ngSwitchCase="CmsFarmFormColumnDisplayType.CUSTOM">
                <div cmsFarmDynamicFormControl [componentId]="col.component_id" [columnId]="col.column_id"></div>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </form>
</ng-container>
