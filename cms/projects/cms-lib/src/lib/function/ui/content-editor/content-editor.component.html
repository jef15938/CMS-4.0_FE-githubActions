<div>
  <mat-menu #stateMenu="matMenu">
    <div mat-menu-item [class.current-state]="manager?.stateManager?.currentIndex === 0">Init</div>
    <div mat-menu-item *ngFor="let state of manager?.stateManager?.states; let i = index;"
      [class.current-state]="manager?.stateManager?.currentIndex === i+1">{{state.action}}</div>
  </mat-menu>
</div>
<div class="cms-content-editor">
  <!-- 按鈕們 -->
  <div #clickCapturelistenerBlock class="btn-panel dark-style" *ngIf="mode===EditorMode.EDIT">
    <button type="button" tabindex="-1" mat-icon-button alt="save" #btnSave (click)="save()" *ngIf="btnSave"
      [disabled]="saved">
      <mat-icon>save</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="undo" #btnUndo
      [disabled]="!manager?.stateManager?.hasPreviousState"
      (click)="resetSelected(); manager?.stateManager?.back(); setEditorUnsaved(); contentViewRenderer?.checkView();">
      <mat-icon>undo</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="redo" #btnRedo
      [disabled]="!manager?.stateManager?.hasNextState"
      (click)="resetSelected(); manager?.stateManager?.forward(); setEditorUnsaved(); contentViewRenderer?.checkView();">
      <mat-icon>redo</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="state list" #menuTrigger="matMenuTrigger"
      [matMenuTriggerFor]="stateMenu">
      <mat-icon>list</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="clear" #btnClear (click)="clear()">
      <mat-icon>delete</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="close" #btnClose (click)="close()" *ngIf="btnClose">
      <mat-icon>clear</mat-icon>
    </button>
  </div>
  <div tabindex="0" class="main-block" *ngIf="manager?.stateManager?.currentState?.snapShot"
    [class.layout-control]="layoutControlPanel?.show" [class.content-control]="contentControlPanel?.show">
    <!-- 頁面內容 -->
    <div #clickCapturelistenerBlock class="content-panel" [class.scale]="isScaleContent">
      <cms-content-view-renderer [contentInfo]="manager?.stateManager?.currentState?.snapShot" [mode]="mode"
        (select)="onViewSelected($event)"
        (addTemplateBtnClick)="resetSelected();manager.selectedTemplateAddBtn=$event;">
      </cms-content-view-renderer>
    </div>
    <!-- 版面控制 -->
    <div class="layout-control-panel" [class.active]="layoutControlPanel?.show">
      <cms-layout-control-panel [selectedBtn]="manager.selectedTemplateAddBtn"
        [selectableTemplates]="selectableTemplates"
        (templateAdd)="resetSelected(); manager.stateManager.preserveState('AddTemplate : '+$event); setEditorUnsaved(); contentViewRenderer?.checkView();">
      </cms-layout-control-panel>
    </div>
    <!-- 內容編輯 -->
    <div class="content-edit-panel" [class.active]="contentControlPanel?.show">
      <cms-content-control-panel [manager]="manager" [selected]="manager.selectedViewElementEvent"
        (needScale)="isScaleContent=$event;" (changePreserve)="setEditorUnsaved();"
        (needCheckView)="contentViewRenderer?.checkView($event);"></cms-content-control-panel>
    </div>
  </div>
</div>
