<div>
  <mat-menu #stateMenu="matMenu">
    <button type="button" tabindex="-1" mat-menu-item [class.current-state]="manager?.stateManager?.currentIndex === 0"
      (click)="resetSelected(); manager?.stateManager?.back(manager?.stateManager?.currentIndex); setEditorUnsaved(); contentViewRenderer?.checkView();">Init</button>
    <button type="button" tabindex="-1" mat-menu-item
      *ngFor="let state of manager?.stateManager?.states; let i = index;"
      [class.current-state]="manager?.stateManager?.currentIndex === i+1"
      (click)="resetSelected(); manager?.stateManager?.back(manager?.stateManager?.currentIndex - (i+1)); setEditorUnsaved(); contentViewRenderer?.checkView();">
      {{state.action}}</button>
  </mat-menu>
</div>
<div class="cms-content-editor">
  <!-- 按鈕們 -->
  <div #clickCapturelistenerBlock class="btn-panel dark-style" *ngIf="editorMode===EditorMode.EDIT">
    <button type="button" tabindex="-1" mat-icon-button alt="save" (click)="save()" *ngIf="!!contentID"
      [disabled]="saved">
      <mat-icon>save</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="undo" [disabled]="!manager?.stateManager?.hasPreviousState"
      (click)="resetSelected(); manager?.stateManager?.back(); setEditorUnsaved(); contentViewRenderer?.checkView();">
      <mat-icon>undo</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="redo" [disabled]="!manager?.stateManager?.hasNextState"
      (click)="resetSelected(); manager?.stateManager?.forward(); setEditorUnsaved(); contentViewRenderer?.checkView();">
      <mat-icon>redo</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="state list" #menuTrigger="matMenuTrigger"
      [matMenuTriggerFor]="stateMenu">
      <mat-icon>list</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="clear" (click)="clear()">
      <mat-icon>delete</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-icon-button alt="close" (click)="close()" *ngIf="btnClose">
      <mat-icon>clear</mat-icon>
    </button>
    <button type="button" tabindex="-1" mat-button alt="transtorm layout">
      變更版面
    </button>
    <button type="button" tabindex="-1" mat-button alt="transtorm layout">
      編輯內容
    </button>
    <button type="button" tabindex="-1" mat-button alt="transtorm layout">
      預覽
    </button>
  </div>
  <div tabindex="0" class="main-block" *ngIf="manager?.stateManager?.currentState?.snapShot"
    [class.layout-control]="layoutControlPanel?.show" [class.content-control]="contentControlPanel?.show">
    <!-- 頁面內容 -->
    <div #clickCapturelistenerBlock class="content-panel" [class.scale]="isScaleContent">
      <cms-content-view-renderer [contentInfo]="manager?.stateManager?.currentState?.snapShot" [editorMode]="editorMode"
        (select)="onViewSelected($event)"
        (addTemplateBtnClick)="resetSelected();manager.selectedTemplateAddBtn=$event;">
      </cms-content-view-renderer>
    </div>
    <!-- 版面控制 -->
    <div class="layout-control-panel" [class.active]="layoutControlPanel?.show">
      <cms-layout-control-panel [selectedBtn]="manager.selectedTemplateAddBtn"
        [selectableTemplates]="selectableTemplates"
        (templateAdd)="resetSelected(); manager.stateManager.preserveState('AddTemplate : '+$event); setEditorUnsaved(); contentViewRenderer?.checkView();">
      </cms-layout-control-panel>
    </div>
    <!-- 內容編輯 -->
    <div class="content-edit-panel" [class.active]="contentControlPanel?.show">
      <cms-content-control-panel [manager]="manager" [selected]="manager.selectedViewElementEvent"
        (templateMove)="isScaleContent=$event;" (contentChange)="setEditorUnsaved();"
        (needCheckView)="contentViewRenderer?.checkView($event);"></cms-content-control-panel>
    </div>
  </div>
</div>
