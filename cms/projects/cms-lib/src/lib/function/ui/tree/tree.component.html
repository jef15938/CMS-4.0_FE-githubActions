<div class="cms-tree" (selectstart)="onSelectstart($event)">
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="cms-tree__body">
    <!-- This is the tree node template for leaf nodes -->
    <mat-tree-node class="cms-tree__node pointer" *matTreeNodeDef="let node" matTreeNodeToggle>
      <div class="cms-tree__node__head " [class.cms-tree__node__head--selected]="node===selectedNode"
        [draggable]="draggable" [class.drag-over]="draggable&&dragNodeExpandOverNode===node&&dragNode!==node"
        (dragstart)="handleDragStart($event, node);" (dragover)="handleDragOver($event, node);"
        (drop)="handleDrop($event, node);" (dragend)="handleDragEnd($event);" (dblclick)="onRowDbClicked($event, node)"
        (click)="onRowClicked($event, node)" cmsRightClickHandler (rightClick)="onRowRightClicked(node)">

        <mat-checkbox class="cms-tree__node__head__checkbox" [checked]="checkedNodes.indexOf(node)>-1"
          (change)="onNodeCheckboxChange($event, node)"
          [class.cms-tree__node__head__checkbox--unactive]="!checkbox || (checkbox && node|nodeCheckboxDisabled:checkboxDisabled)">

          <span *ngIf="customNodeRenderer" neuxDynamicWrapper [componentClass]="customNodeRenderer"
            [onComponentLoad]="this | nodeRenderOnload:node:context">
          </span>

          <span *ngIf="!customNodeRenderer">
            {{node[nodeDisplayField]}}
          </span>

        </mat-checkbox>
      </div>
    </mat-tree-node>


    <mat-nested-tree-node class="cms-tree__node" *matTreeNodeDef="let node; when: hasChild">

      <div class="cms-tree__node__head pointer" [class.cms-tree__node__head--selected]="node===selectedNode"
        [draggable]="draggable" [class.drag-over]="draggable&&dragNodeExpandOverNode===node&&dragNode!==node"
        (dragstart)="handleDragStart($event, node);" (dragover)="handleDragOver($event, node);"
        (drop)="handleDrop($event, node);" (dragend)="handleDragEnd($event);" (dblclick)="onRowDbClicked($event, node)"
        (click)="onRowClicked($event, node)" cmsRightClickHandler (rightClick)="onRowRightClicked(node)">

        <mat-checkbox [checked]="checkedNodes.indexOf(node)>-1" (change)="onNodeCheckboxChange($event, node)"
          [class.cms-tree__node__head__checkbox--unactive]="!checkbox || (checkbox && node|nodeCheckboxDisabled:checkboxDisabled)">
          <span *ngIf="customNodeRenderer" neuxDynamicWrapper [componentClass]="customNodeRenderer"
            [onComponentLoad]="this | nodeRenderOnload:node:context">
          </span>
          <span *ngIf="!customNodeRenderer">
            {{node[nodeDisplayField]}}
          </span>
          <button type="button" tabindex="-1" mat-icon-button class="node-expand-btn"
            [attr.aria-label]="'toggle ' + node[nodeDisplayField]">
            <mat-icon class="mat-icon-rtl-mirror">
              {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
            </mat-icon>
          </button>
        </mat-checkbox>
      </div>
      <div class="cms-tree__node__body" [class.cms-tree__node__body--invisible]="!treeControl.isExpanded(node)">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>

    </mat-nested-tree-node>
  </mat-tree>
</div>
