<div class="sitemap-node-creat-modal modal-form-layout" *ngIf="sitemapMaintainModel">
  <form class="modal-form-layout__form" #form="ngForm">
    <div class="modal-form-layout__row">
      <div class="modal-form-layout__col">
        <mat-form-field appearance="outline">
          <mat-label>節點名稱</mat-label>
          <input matInput [(ngModel)]="sitemapMaintainModel.node_name" name="node_name" required maxlength="50"
            #modelNodeName="ngModel">
          <mat-error *ngIf="modelNodeName?.errors?.required">必填欄位</mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="modal-form-layout__row">
      <div class="modal-form-layout__col">
        <mat-form-field appearance="outline">
          <mat-label>節點類型</mat-label>
          <mat-select [(ngModel)]="sitemapMaintainModel.node_type" name="node_type"
            [compareWith]="compareOptionWithModel" (selectionChange)="sitemapMaintainModel.checkFieldsByNodeType()">
            <mat-option *ngFor="let option of nodeTypeOptions" [value]="option.value">
              {{option.name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <ng-container [ngSwitch]="sitemapMaintainModel.node_type">
      <!-- URL -->
      <ng-container *ngSwitchCase="NodeType.URL">
        <div class="modal-form-layout__row">
          <div class="modal-form-layout__col">
            <mat-form-field appearance="outline">
              <mat-label>連結類型</mat-label>
              <mat-select [(ngModel)]="sitemapMaintainModel.url_type" name="url_type" required>
                <mat-option *ngFor="let option of urlTypeOptions" [value]="option.value">
                  {{option.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <ng-container [ngSwitch]="sitemapMaintainModel.url_type">
          <!-- 站內 -->
          <ng-container *ngSwitchCase="UrlType.INSIDE">
            <div class="modal-form-layout__row">
              <div class="modal-form-layout__col">
                <mat-form-field appearance="outline">
                  <mat-label>站內節點ID</mat-label>
                  <input matInput [(ngModel)]="sitemapMaintainModel.url_link_node_id" name="url_link_node_id" required>
                </mat-form-field>
              </div>
            </div>
          </ng-container>
          <!-- 站外 -->
          <ng-container *ngSwitchCase="UrlType.OUTSIDE">
            <div class="modal-form-layout__row">
              <div class="modal-form-layout__col">
                <mat-form-field appearance="outline">
                  <mat-label>站外網址</mat-label>
                  <input matInput [(ngModel)]="sitemapMaintainModel.url" name="url" required maxlength="500"
                    #modelUrl="ngModel">
                  <mat-error *ngIf="modelUrl?.errors?.required">必填欄位</mat-error>
                </mat-form-field>
              </div>
            </div>
          </ng-container>
          <!-- 共通 -->
          <div class="modal-form-layout__row">
            <div class="modal-form-layout__col">
              <mat-form-field appearance="outline">
                <mat-label>另開視窗</mat-label>
                <mat-select [(ngModel)]="sitemapMaintainModel.url_blank" name="url_blank" required>
                  <mat-option *ngFor="let option of urlBlankTypeOptions" [value]="option.value">
                    {{option.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </ng-container>
      </ng-container>
      <!-- CONTENT -->
      <ng-container *ngSwitchCase="NodeType.CONTENT">
        <div class="modal-form-layout__row">
          <div class="modal-form-layout__col">
            <mat-form-field appearance="outline">
              <mat-label>版面元件</mat-label>
              <mat-select #layoutSelect [(ngModel)]="sitemapMaintainModel.layout_id" name="layout_id" required
                panelClass="layout-id-select-panel">
                <mat-option *ngFor="let layout of layouts" [value]="layout.layout_id" style="display: none;">
                  {{layout.layout_name}}
                </mat-option>
                <mat-option #layoutOption class="layout-id-select-panel-option">
                  <div class="layout-select__collapse__option" (click)="cancelEvent($event)">
                    <ul class="layout-select__collapse__list">
                      <li *ngFor="let option of layouts" class="layout-select__list__item"
                        [class.layout-select__list__item--actived]="option.layout_id===activedLayoutID"
                        (mouseenter)="setActivedLayout(option, true)" (mouseleave)="setActivedLayout(option, false)">
                        <mat-checkbox [checked]="option.layout_id===sitemapMaintainModel.layout_id"
                          (click)="selectedLayout(option, layoutSelect)">
                          {{option.layout_name}}
                        </mat-checkbox>
                      </li>
                    </ul>
                    <div class="layout-select__collapse__thumbnail">
                      <ng-container *ngIf="(activedLayoutID | getLayoutByLayoutID : this.layouts); let actived;">
                        <img [src]="'./assets/img/layout/'+actived.layout_id+'.png'">
                      </ng-container>
                    </div>
                  </div>
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="modal-form-layout__row">
          <div class="modal-form-layout__col">
            <mat-form-field appearance="outline">
              <mat-label>節點連結路徑</mat-label>
              <textarea matInput [(ngModel)]="sitemapMaintainModel.content_path" name="content_path" maxlength="100"
                rows="1" pattern="^[A-Za-z][A-Za-z0-9\-\_]*$" #modelContentPath="ngModel"></textarea>
              <mat-error *ngIf="modelNodeName?.errors?.required">限英數字和-_</mat-error>
            </mat-form-field>
          </div>
        </div>
      </ng-container>

      <div class="modal-form-layout__row">
        <div class="modal-form-layout__col">
          <mat-form-field appearance="outline">
            <mat-label>Meta標題</mat-label>
            <textarea matInput [(ngModel)]="sitemapMaintainModel.meta_title" name="meta_title" required maxlength="500"
              rows="1" #modelMetaTitle="ngModel"></textarea>
            <mat-error *ngIf="modelNodeName?.errors?.required">必填欄位</mat-error>
          </mat-form-field>
        </div>
      </div>

      <div class="modal-form-layout__row">
        <div class="modal-form-layout__col">
          <mat-form-field appearance="outline">
            <mat-label>Meta描述</mat-label>
            <textarea matInput [(ngModel)]="sitemapMaintainModel.meta_description" name="meta_description" rows="1"
              maxlength="500"></textarea>
          </mat-form-field>
        </div>
      </div>
      <div class="modal-form-layout__row">
        <div class="modal-form-layout__col">
          <mat-form-field appearance="outline">
            <mat-label>Meta關鍵字</mat-label>
            <textarea matInput [(ngModel)]="sitemapMaintainModel.meta_keyword" name="meta_keyword" rows="1"
              maxlength="500"></textarea>
          </mat-form-field>
        </div>
      </div>
      <div class="modal-form-layout__row">
        <div class="modal-form-layout__col gallery-btn-container">
          <mat-form-field appearance="outline">
            <mat-label>Meta圖片(1200x628)</mat-label>
            <input matInput [value]="metaImageName" name="meta_image" readonly>
          </mat-form-field>
          <button class="modal-form-layout__btn gallery-btn" type="button" tabindex="0" mat-button
            (click)="openGallery()">媒體庫</button>
        </div>
      </div>
    </ng-container>

    <div class="modal-form-layout__row">
      <div class="modal-form-layout__col">
        <mat-form-field appearance="outline">
          <mat-label>可選擇群組</mat-label>
          <mat-select [(ngModel)]="assignGroupIds" name="assign_group_id" required multiple>
            <mat-option *ngFor="let group of groups" [value]="group.group_id">
              {{group.group_name}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="modal-form-layout__btn-group  btn-group">
      <button type="button" class="modal-form-layout__btn" tabindex="0" mat-raised-button (click)="close()">取消</button>
      <button type="button" class="modal-form-layout__btn" tabindex="0" mat-raised-button (click)="confirm()"
        [disabled]="form.invalid">儲存</button>
    </div>
  </form>
</div>
